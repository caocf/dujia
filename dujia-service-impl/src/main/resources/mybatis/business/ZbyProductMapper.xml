<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.gome.dujia.mapper.business.ZbyProductMapper" >
  <resultMap id="BaseResultMap" type="cn.com.gome.dujia.model.ZbyProduct" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="product_id" property="productId" jdbcType="VARCHAR" />
    <result column="vender_id" property="venderId" jdbcType="VARCHAR" />
    <result column="main_name" property="mainName" jdbcType="VARCHAR" />
    <result column="sub_name" property="subName" jdbcType="VARCHAR" />
    <result column="show_name" property="showName" jdbcType="VARCHAR" />
    <result column="app_title" property="appTitle" jdbcType="VARCHAR" />
    <result column="days" property="days" jdbcType="INTEGER" />
    <result column="begin_date" property="beginDate" jdbcType="VARCHAR" />
    <result column="over_date" property="overDate" jdbcType="VARCHAR" />
    <result column="recom_image_url_local" property="recomImageUrlLocal" jdbcType="VARCHAR" />
    <result column="recom_image_url" property="recomImageUrl" jdbcType="VARCHAR" />
    <result column="image_url_local" property="imageUrlLocal" jdbcType="VARCHAR" />
    <result column="image_url" property="imageUrl" jdbcType="VARCHAR" />
    <result column="city_id" property="cityId" jdbcType="VARCHAR" />
    <result column="city_name" property="cityName" jdbcType="VARCHAR" />
    <result column="city_pinyin" property="cityPinyin" jdbcType="VARCHAR" />
    <result column="product_min_price" property="productMinPrice" jdbcType="DECIMAL" />
    <result column="product_max_price" property="productMaxPrice" jdbcType="DECIMAL" />
    <result column="sell_unit" property="sellUnit" jdbcType="VARCHAR" />
    <result column="product_feature" property="productFeature" jdbcType="LONGVARCHAR" />
    <result column="product_route_des" property="productRouteDes" jdbcType="LONGVARCHAR" />
    <result column="preferential" property="preferential" jdbcType="LONGVARCHAR" />
    <result column="product_image_url_list_local" property="productImageUrlListLocal" jdbcType="LONGVARCHAR" />
    <result column="product_image_url_list" property="productImageUrlList" jdbcType="LONGVARCHAR" />
    <result column="attention_info" property="attentionInfo" jdbcType="LONGVARCHAR" />
    <result column="refund_rule_info" property="refundRuleInfo" jdbcType="VARCHAR" />
    <result column="tip_info" property="tipInfo" jdbcType="VARCHAR" />
    <result column="transport_info" property="transportInfo" jdbcType="LONGVARCHAR" />
    <result column="remind_info" property="remindInfo" jdbcType="LONGVARCHAR" />
    <result column="hotel_feature_info" property="hotelFeatureInfo" jdbcType="VARCHAR" />
    <result column="scenery_feature_info" property="sceneryFeatureInfo" jdbcType="VARCHAR" />
    <result column="recommend_reason" property="recommendReason" jdbcType="VARCHAR" />
    <result column="product_include" property="productInclude" jdbcType="LONGVARCHAR" />
    <result column="product_long_name" property="productLongName" jdbcType="VARCHAR" />
    <result column="sale_count" property="saleCount" jdbcType="INTEGER" />
    <result column="browse_count" property="browseCount" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="is_delete" property="isDelete" jdbcType="BIT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    product_id, vender_id, main_name, sub_name, show_name, app_title, days, begin_date, 
    over_date, recom_image_url_local, recom_image_url, image_url_local, image_url, city_id, 
    city_name, city_pinyin, product_min_price, product_max_price, sell_unit, product_feature, 
    product_route_des, preferential, product_image_url_list_local,product_image_url_list, attention_info, refund_rule_info,
    tip_info, transport_info, remind_info, hotel_feature_info, scenery_feature_info, 
    recommend_reason, product_include, product_long_name, sale_count, browse_count, create_time, 
    update_time, is_delete
  </sql>

  <resultMap id="simpleResultMap" type="cn.com.gome.dujia.dto.ZbyProductDetailDto">
    <result column="product_id" property="productId" jdbcType="VARCHAR" />
    <result column="vender_id" property="venderId" jdbcType="VARCHAR" />
    <result column="main_name" property="mainName" jdbcType="VARCHAR" />
    <result column="sub_name" property="subName" jdbcType="VARCHAR" />
    <result column="app_title" property="appTitle" jdbcType="VARCHAR" />
    <result column="days" property="days" jdbcType="INTEGER" />
    <result column="begin_date" property="beginDate" jdbcType="VARCHAR" />
    <result column="over_date" property="overDate" jdbcType="VARCHAR" />
    <result column="city_id" property="cityId" jdbcType="VARCHAR" />
    <result column="city_name" property="cityName" jdbcType="VARCHAR" />
    <result column="city_pinyin" property="cityPinyin" jdbcType="VARCHAR" />
    <result column="product_min_price" property="productMinPrice" jdbcType="DECIMAL" />
    <result column="product_max_price" property="productMaxPrice" jdbcType="DECIMAL" />
    <result column="sell_unit" property="sellUnit" jdbcType="VARCHAR" />
    <result column="product_feature" property="productFeature" jdbcType="LONGVARCHAR" />
    <result column="product_route_des" property="productRouteDes" jdbcType="LONGVARCHAR" />
    <result column="preferential" property="preferential" jdbcType="LONGVARCHAR" />
    <result column="product_image_url_list" property="productImageUrlList" jdbcType="LONGVARCHAR" />
    <result column="attention_info" property="attentionInfo" jdbcType="LONGVARCHAR" />
    <result column="refund_rule_info" property="refundRuleInfo" jdbcType="VARCHAR" />
    <result column="tip_info" property="tipInfo" jdbcType="VARCHAR" />
    <result column="remind_info" property="remindInfo" jdbcType="LONGVARCHAR" />
    <result column="hotel_feature_info" property="hotelFeatureInfo" jdbcType="VARCHAR" />
    <result column="scenery_feature_info" property="sceneryFeatureInfo" jdbcType="VARCHAR" />
    <result column="recommend_reason" property="recommendReason" jdbcType="VARCHAR" />
    <result column="product_include" property="productInclude" jdbcType="LONGVARCHAR" />
    <result column="transport_info" property="transportInfo" jdbcType="LONGVARCHAR" />
    <result column="is_delete"      property="isDelete"      jdbcType="BIT" />
  </resultMap>

  <resultMap id="quickResultMap" type="cn.com.gome.dujia.dto.QuickLinkDto" >
    <result column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
  </resultMap>


  <!-- 根据条件获取线路详情-->
  <select id="getProductDetailDtoById" resultMap="simpleResultMap" parameterType="java.lang.String">
      SELECT <include refid="Base_Column_List" />
      FROM zby_product
      WHERE product_id=#{productId}
  </select>

  <!-- 获取城市所有线路含有的游玩天数列表-->
  <select id="queryTravelDays" resultMap="quickResultMap" parameterType="java.lang.String">
    SELECT
        days AS id,
		CONCAT(days,"天",days-1,"晚") AS name
    FROM zby_product
    WHERE city_id=#{cityId}
    GROUP BY days
    ORDER BY days ASC
    LIMIT 5;
  </select>


  <insert id="batchInsert" parameterType="java.util.List">
    INSERT INTO zby_product (
    product_id ,
    vender_id ,
    main_name ,
    sub_name ,
    show_name ,
    app_title ,
    days ,
    begin_date ,
    over_date ,
    recom_image_url_local ,
    recom_image_url ,
    image_url_local ,
    image_url ,
    city_id ,
    city_name ,
    city_pinyin ,
    product_min_price ,
    product_max_price ,
    sell_unit ,
    product_feature ,
    product_route_des ,
    preferential ,
    product_image_url_list_local ,
    product_image_url_list ,
    attention_info ,
    refund_rule_info ,
    tip_info ,
    transport_info ,
    remind_info ,
    hotel_feature_info ,
    scenery_feature_info ,
    recommend_reason ,
    product_include ,
    product_long_name ,
    sale_count ,
    browse_count ,
    create_time ,
    update_time ,
    is_delete
    ) VALUES
    <foreach collection="list" index="index" item="item" separator=",">
    (
      #{item.productId} ,
      #{item.venderId} ,
      #{item.mainName} ,
      #{item.subName} ,
      #{item.showName} ,
      #{item.appTitle} ,
      #{item.days} ,
      #{item.beginDate} ,
      #{item.overDate} ,
      #{item.recomImageUrlLocal} ,
      #{item.recomImageUrl} ,
      #{item.imageUrlLocal} ,
      #{item.imageUrl} ,
      #{item.cityId} ,
      #{item.cityName} ,
      #{item.cityPinyin} ,
      #{item.productMinPrice} ,
      #{item.productMaxPrice} ,
      #{item.sellUnit} ,
      #{item.productFeature} ,
      #{item.productRouteDes} ,
      #{item.preferential} ,
      #{item.productImageUrlListLocal} ,
      #{item.productImageUrlList} ,
      #{item.attentionInfo} ,
      #{item.refundRuleInfo} ,
      #{item.tipInfo} ,
      #{item.transportInfo} ,
      #{item.remindInfo} ,
      #{item.hotelFeatureInfo} ,
      #{item.sceneryFeatureInfo} ,
      #{item.recommendReason} ,
      #{item.productInclude} ,
      #{item.productLongName} ,
      #{item.saleCount} ,
      #{item.browseCount} ,
      #{item.createTime} ,
      #{item.updateTime} ,
      #{item.isDelete}
      )
    </foreach>
  </insert>



  <update id="updateIsDelete" parameterType="cn.com.gome.dujia.model.ZbyProduct">
    UPDATE zby_product SET
    is_delete = #{isDelete}
    WHERE
    product_id = #{productId}
  </update>


  <!-- 根据主键查询PRODUCT-->
  <select id="selectByProductId"  resultMap="BaseResultMap"   parameterType="java.lang.String">
    SELECT * from zby_product where product_id = #{productId} ;
  </select>



  <update id="batchUpdate" parameterType="java.util.List" >
      <foreach collection="list" index="index" item="item" separator=";">
              UPDATE zby_product
                  <set>
                      <if test="item.mainName != null">
                        main_name = #{item.mainName},
                      </if>
                      <if test="item.subName != null">
                        sub_name = #{item.subName},
                      </if>
                      <if test="item.showName != null">
                        show_name = #{item.showName},
                      </if>
                      <if test="item.appTitle != null">
                        app_title = #{item.appTitle},
                      </if>
                      <if test="item.days != null">
                        days = #{item.days},
                      </if>
                      <if test="item.beginDate != null">
                        begin_date = #{item.beginDate},
                      </if>

                       <if test="item.overDate != null">
                        over_date = #{item.overDate},
                      </if>

                       <if test="item.recomImageUrlLocal != null">
                        recom_image_url_local = #{item.recomImageUrlLocal},
                      </if>

                       <if test="item.recomImageUrl != null">
                        recom_image_url = #{item.recomImageUrl},
                      </if>

                      <if test="item.imageUrlLocal != null">
                        image_url_local = #{item.imageUrlLocal},
                      </if>

                       <if test="item.imageUrl != null">
                        image_url = #{item.imageUrl},
                      </if>

                      <if test="item.cityId != null">
                        city_id = #{item.cityId},
                      </if>

                       <if test="item.cityName != null">
                        city_name = #{item.cityName},
                      </if>

                      <if test="item.cityPinyin != null">
                        city_id = #{item.cityPinyin},
                      </if>

                       <if test="item.productMinPrice != null">
                        product_min_price = #{item.productMinPrice},
                      </if>

                      <if test="item.cityPinyin != null">
                        city_id = #{item.cityPinyin},
                      </if>

                       <if test="item.productMaxPrice != null">
                        product_max_price = #{item.productMaxPrice},
                      </if>


                       <if test="item.sellUnit != null">
                        sell_unit = #{item.sellUnit},
                      </if>

                       <if test="item.productMaxPrice != null">
                        product_max_price = #{item.productMaxPrice},
                      </if>
                      <if test="item.sellUnit != null">
                        sell_unit = #{item.sellUnit},
                      </if>

                      <if test="item.productFeature != null">
                        product_feature = #{item.productFeature},
                      </if>
                      <if test="item.productRouteDes != null">
                        product_route_des = #{item.productRouteDes},
                      </if>

                      <if test="item.preferential != null">
                        preferential = #{item.preferential},
                      </if>
                      <if test="item.productImageUrlListLocal != null">
                        product_image_url_list_local = #{item.productImageUrlListLocal},
                      </if>

                      <if test="item.productImageUrlList != null">
                        product_image_url_list = #{item.productImageUrlList},
                      </if>
                      <if test="item.attentionInfo != null">
                        attention_info = #{item.attentionInfo},
                      </if>

                      <if test="item.refundRuleInfo != null">
                        refund_rule_info = #{item.refundRuleInfo},
                      </if>
                      <if test="item.tipInfo != null">
                        tip_info = #{item.tipInfo},
                      </if>

                      <if test="item.transportInfo != null">
                        transport_info = #{item.transportInfo},
                      </if>
                      <if test="item.remindInfo != null">
                        remind_info = #{item.remindInfo},
                      </if>

                      <if test="item.hotelFeatureInfo != null">
                        hotel_feature_info = #{item.hotelFeatureInfo},
                      </if>
                      <if test="item.sceneryFeatureInfo != null">
                        scenery_feature_info = #{item.sceneryFeatureInfo},
                      </if>

                      <if test="item.recommendReason != null">
                        recommend_reason = #{item.recommendReason},
                      </if>
                      <if test="item.productInclude != null">
                        product_include = #{item.productInclude},
                      </if>

                      <if test="item.productLongName != null">
                        product_long_name = #{item.productLongName},
                      </if>
                      <if test="item.saleCount != null">
                        sale_count = #{item.saleCount},
                      </if>

                      <if test="item.browseCount != null">
                        browse_count = #{item.browseCount},
                      </if>

                       <if test="item.isDelete != null">
                        is_delete = #{item.isDelete},
                      </if>
                  </set>
              WHERE
                  product_id = #{item.productId}

      </foreach>
  </update>

  <!-- 批量更新售卖量、点击量 -->
  <update id="batchUpdateSBCount" parameterType="java.util.List">
  <foreach collection="list" index="index" item="item" separator=";">
    update zby_product
     <set>
       <if test="item.saleCount != null">
         sale_count = sale_count + #{item.saleCount},
       </if>
       <if test="item.browseCount != null">
         browse_count = browse_count + #{item.browseCount},
       </if>
     </set>
    <where>
       product_id = #{item.productId}
    </where>
  </foreach>
  </update>
  
  <!-- 查询线路销量，浏览量 -->
  <select id="querySaleBrowseCount" resultMap="BaseResultMap" parameterType="cn.com.gome.dujia.model.ZbyProduct">
	SELECT product_id, sale_count, browse_count from zby_product
    <where>
    	<if test="updateTime != null">
        	<![CDATA[ and update_time >= #{updateTime,jdbcType=TIMESTAMP} ]]>
      	</if>
      	<if test="isDelete != null">
        	and is_delete = #{isDelete,jdbcType=BIT}
      </if>
    </where>
  </select>



    <update id="updateSelective" parameterType="cn.com.gome.dujia.model.ZbyProduct" >
            UPDATE zby_product
            <set>
                <if test="mainName != null">
                    main_name = #{mainName},
                </if>
                <if test="subName != null">
                    sub_name = #{subName},
                </if>
                <if test="showName != null">
                    show_name = #{showName},
                </if>
                <if test="appTitle != null">
                    app_title = #{appTitle},
                </if>
                <if test="days != null">
                    days = #{days},
                </if>
                <if test="beginDate != null">
                    begin_date = #{beginDate},
                </if>

                <if test="overDate != null">
                    over_date = #{overDate},
                </if>

                <if test="recomImageUrlLocal != null">
                    recom_image_url_local = #{recomImageUrlLocal},
                </if>

                <if test="recomImageUrl != null">
                    recom_image_url = #{recomImageUrl},
                </if>

                <if test="imageUrlLocal != null">
                    image_url_local = #{imageUrlLocal},
                </if>

                <if test="imageUrl != null">
                    image_url = #{imageUrl},
                </if>

                <if test="cityId != null">
                    city_id = #{cityId},
                </if>

                <if test="cityName != null">
                    city_name = #{cityName},
                </if>

                <if test="cityPinyin != null">
                    city_id = #{cityPinyin},
                </if>

                <if test="productMinPrice != null">
                    product_min_price = #{productMinPrice},
                </if>

                <if test="cityPinyin != null">
                    city_id = #{cityPinyin},
                </if>

                <if test="productMaxPrice != null">
                    product_max_price = #{productMaxPrice},
                </if>


                <if test="sellUnit != null">
                    sell_unit = #{sellUnit},
                </if>

                <if test="productMaxPrice != null">
                    product_max_price = #{productMaxPrice},
                </if>
                <if test="sellUnit != null">
                    sell_unit = #{sellUnit},
                </if>

                <if test="productFeature != null">
                    product_feature = #{productFeature},
                </if>
                <if test="productRouteDes != null">
                    product_route_des = #{productRouteDes},
                </if>

                <if test="preferential != null">
                    preferential = #{preferential},
                </if>
                <if test="productImageUrlListLocal != null">
                    product_image_url_list_local = #{productImageUrlListLocal},
                </if>

                <if test="productImageUrlList != null">
                    product_image_url_list = #{productImageUrlList},
                </if>
                <if test="attentionInfo != null">
                    attention_info = #{attentionInfo},
                </if>

                <if test="refundRuleInfo != null">
                    refund_rule_info = #{refundRuleInfo},
                </if>
                <if test="tipInfo != null">
                    tip_info = #{tipInfo},
                </if>

                <if test="transportInfo != null">
                    transport_info = #{transportInfo},
                </if>
                <if test="remindInfo != null">
                    remind_info = #{remindInfo},
                </if>

                <if test="hotelFeatureInfo != null">
                    hotel_feature_info = #{hotelFeatureInfo},
                </if>
                <if test="sceneryFeatureInfo != null">
                    scenery_feature_info = #{sceneryFeatureInfo},
                </if>

                <if test="recommendReason != null">
                    recommend_reason = #{recommendReason},
                </if>
                <if test="productInclude != null">
                    product_include = #{productInclude},
                </if>

                <if test="productLongName != null">
                    product_long_name = #{productLongName},
                </if>

                <if test="isDelete != null">
                    is_delete = #{isDelete},
                </if>
            </set>
            WHERE
            product_id = #{productId}

    </update>

	<!-- 查询线路信息 -->
	<select id="queryProductByPIds" parameterType="java.util.List" resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		from zby_product
		<where>
			<if test="list != null">
				and product_id in
				<foreach collection="list" item="item" index="index" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
		</where>
	</select>
	
	<!-- 根据线路id查询游玩天数 -->
	<select id="getTravlDaysByProductId" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT days
		from zby_product
		<where>
				product_id = #{productId}
		</where>
	</select>

    <!-- 获取所有线路含有的游玩天数列表-->
    <select id="queryAllTravelDays" resultType="java.lang.Integer" >
      SELECT DISTINCT	days
      FROM
	  zby_product
	  WHERE is_delete=0
      ORDER BY
	  days
    </select>

    <!-- 获取线路最多的前N个城市-->
    <select id="queryMostLineByCity" resultMap="BaseResultMap"  parameterType="java.util.Map">
        SELECT
            city_id,
            city_name,
            city_pinyin
        FROM
          zby_product p
        WHERE
            p.city_id IN
            <foreach collection="cityIds" item="cityId" index="index" open="("  separator="," close=")">
                #{cityId}
            </foreach>
            GROUP BY
            p.city_id
            ORDER BY count(*) DESC
            <if test="size != null ">
                LIMIT #{size}
            </if>
    </select>
</mapper>